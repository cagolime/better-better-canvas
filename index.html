<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>✦ planner</title>
<link href="https://fonts.googleapis.com/css2?family=IM+Fell+English:ital@0;1&family=Crimson+Text:ital,wght@0,400;1,400&display=swap" rel="stylesheet">
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  background:
    radial-gradient(ellipse at 15% 15%, rgba(255,210,200,0.45) 0%, transparent 50%),
    radial-gradient(ellipse at 85% 75%, rgba(200,230,210,0.35) 0%, transparent 50%),
    radial-gradient(ellipse at 60% 40%, rgba(255,225,180,0.2) 0%, transparent 45%),
    #faf6f0;
  font-family: 'Crimson Text', Georgia, serif;
  color: #4a3728;
  min-height: 100vh;
  display: flex;
  align-items: flex-start;
  justify-content: center;
  padding: 30px 16px;
}

/* ── WIDGET SHELL ── */
.widget {
  width: 300px;
  background:
    radial-gradient(ellipse at 0% 0%, rgba(255,225,210,0.5) 0%, transparent 55%),
    radial-gradient(ellipse at 100% 100%, rgba(210,235,215,0.4) 0%, transparent 55%),
    rgba(255,252,248,0.97);
  border: 1px solid rgba(200,170,150,0.5);
  box-shadow:
    0 4px 24px rgba(180,130,110,0.13),
    0 1px 3px rgba(180,130,110,0.1),
    inset 0 0 0 1px rgba(255,255,255,0.7);
  position: relative;
}

/* ── TITLE BAR ── */
.title-bar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 7px 10px 6px;
  border-bottom: 1px solid rgba(200,170,150,0.3);
  background: linear-gradient(to bottom, rgba(255,240,232,0.9), rgba(248,232,220,0.5));
}

.title-text {
  font-family: 'IM Fell English', serif;
  font-style: italic;
  font-size: 0.92rem;
  color: #9a7060;
  letter-spacing: 0.04em;
  display: flex;
  align-items: center;
  gap: 5px;
}
.title-deco { color: #c8a898; font-size: 0.6rem; }

.settings-btn {
  background: none;
  border: 1px solid rgba(200,170,150,0.4);
  width: 22px; height: 22px;
  display: flex; align-items: center; justify-content: center;
  cursor: pointer;
  font-size: 0.72rem;
  color: #b09880;
  transition: background 0.15s, color 0.15s;
  padding: 0;
  line-height: 1;
}
.settings-btn:hover { background: rgba(220,180,160,0.2); color: #8a6050; }

/* ── TABS ── */
.tabs {
  display: flex;
  border-bottom: 1px solid rgba(200,170,150,0.3);
}
.tab {
  flex: 1;
  text-align: center;
  padding: 5px 4px;
  font-family: 'IM Fell English', serif;
  font-style: italic;
  font-size: 0.72rem;
  color: #b09880;
  cursor: pointer;
  border-right: 1px solid rgba(200,170,150,0.25);
  transition: background 0.15s, color 0.15s;
  letter-spacing: 0.03em;
  user-select: none;
}
.tab:last-child { border-right: none; }
.tab:hover { background: rgba(240,220,210,0.4); color: #8a6050; }
.tab.active {
  background: rgba(255,240,230,0.8);
  color: #7a5040;
  border-bottom: 2px solid rgba(200,150,130,0.5);
  margin-bottom: -1px;
}

/* ── PANELS ── */
.panel { display: none; padding: 10px 12px 12px; }
.panel.active { display: block; }

/* NOTES */
#notes-area {
  width: 100%;
  height: 180px;
  border: none;
  border-left: 2px solid rgba(220,180,160,0.4);
  padding: 5px 8px;
  font-family: 'Crimson Text', serif;
  font-size: 0.88rem;
  line-height: 1.75;
  background: transparent;
  color: #4a3728;
  resize: none;
  outline: none;
  background-image: repeating-linear-gradient(
    transparent, transparent 26px, rgba(200,170,150,0.18) 26px, rgba(200,170,150,0.18) 27px
  );
}
#notes-area::placeholder { color: #cdb8a8; font-style: italic; font-size: 0.85rem; }

.note-footer { display: flex; align-items: center; gap: 8px; margin-top: 7px; }
.tiny-btn {
  background: linear-gradient(to bottom, #f8ece4, #eeddd0);
  color: #8a6050;
  border: 1px solid rgba(180,140,120,0.45);
  padding: 2px 12px;
  font-family: 'IM Fell English', serif;
  font-style: italic;
  font-size: 0.75rem;
  cursor: pointer;
  letter-spacing: 0.04em;
  transition: background 0.15s;
}
.tiny-btn:hover { background: linear-gradient(to bottom, #f0dcd4, #e0c8bc); }
.saved-lbl { font-style: italic; font-size: 0.72rem; color: #8aaa88; display: none; }

/* TASKS */
.add-row {
  display: flex; flex-direction: column; gap: 6px; margin-bottom: 8px;
}
.add-row-top { display: flex; gap: 5px; align-items: flex-end; }
.add-row input[type="text"] {
  flex: 1;
  border: none; border-bottom: 1px solid rgba(200,170,150,0.45);
  padding: 3px 2px;
  font-family: 'Crimson Text', serif; font-size: 0.88rem;
  background: transparent; color: #4a3728; outline: none;
}
.add-row input[type="text"]::placeholder { color: #cdb8a8; font-style: italic; }
.add-row input[type="text"]:focus { border-bottom-color: #c0a090; }
.due-row {
  display: flex; align-items: center; gap: 6px;
}
.due-label {
  font-family: 'IM Fell English', serif;
  font-style: italic;
  font-size: 0.72rem;
  color: #b09880;
  white-space: nowrap;
  flex-shrink: 0;
}
.add-row input[type="datetime-local"] {
  flex: 1;
  border: none; border-bottom: 1px solid rgba(200,170,150,0.45);
  padding: 3px 2px;
  font-family: Georgia, serif; font-size: 0.72rem;
  background: transparent; color: #7a6050; outline: none;
}
.add-row input[type="datetime-local"]:focus { border-bottom-color: #c0a090; }

.task-list { list-style: none; display: flex; flex-direction: column; gap: 4px; max-height: 200px; overflow-y: auto; }
.task-list::-webkit-scrollbar { width: 3px; }
.task-list::-webkit-scrollbar-thumb { background: rgba(200,170,150,0.4); }

.task-item {
  display: flex; align-items: center; gap: 6px;
  padding: 4px 6px;
  border-left: 2px solid rgba(200,180,160,0.4);
  background: rgba(255,250,245,0.6);
  font-size: 0.84rem;
}
.task-item.done { opacity: 0.4; }
.task-item.done .task-name { text-decoration: line-through; text-decoration-color: #c8a898; }
.task-item.urgent { border-left-color: #e0a070; background: rgba(255,240,215,0.7); }
.task-item.overdue { border-left-color: #c88070; background: rgba(255,228,218,0.7); }

.task-check { width: 12px; height: 12px; accent-color: #a08878; cursor: pointer; flex-shrink: 0; }
.task-name { flex: 1; font-family: 'Crimson Text', serif; line-height: 1.2; }
.task-due { font-size: 0.62rem; color: #b09880; font-style: italic; white-space: nowrap; }
.task-item.urgent .task-due { color: #b07830; }
.task-item.overdue .task-due { color: #b06040; }
.del-btn {
  background: none; border: none; cursor: pointer;
  color: #d0b8a8; font-size: 0.65rem; padding: 1px 2px;
  line-height: 1; transition: color 0.15s; flex-shrink: 0;
}
.del-btn:hover { color: #c07060; }
.empty-msg { font-style: italic; color: #c0a898; font-size: 0.8rem; text-align: center; padding: 12px 0; }

/* ── SETTINGS PANEL (overlay) ── */
.settings-overlay {
  display: none;
  position: absolute;
  inset: 0;
  background:
    radial-gradient(ellipse at 0% 0%, rgba(255,225,210,0.6) 0%, transparent 55%),
    rgba(255,252,248,0.98);
  z-index: 100;
  padding: 10px 12px 12px;
  border: 1px solid rgba(200,170,150,0.5);
}
.settings-overlay.open { display: block; }

.settings-header {
  display: flex; justify-content: space-between; align-items: center;
  margin-bottom: 10px;
  padding-bottom: 7px;
  border-bottom: 1px solid rgba(200,170,150,0.3);
}
.settings-title {
  font-family: 'IM Fell English', serif;
  font-style: italic;
  font-size: 0.88rem;
  color: #9a7060;
}
.close-btn {
  background: none; border: 1px solid rgba(200,170,150,0.4);
  width: 20px; height: 20px;
  display: flex; align-items: center; justify-content: center;
  cursor: pointer; font-size: 0.65rem; color: #b09880;
  transition: background 0.15s;
}
.close-btn:hover { background: rgba(220,180,160,0.2); color: #8a6050; }

.settings-label {
  font-size: 0.75rem; color: #9a8070;
  font-style: italic; margin-bottom: 7px; line-height: 1.5;
}

.upload-zone {
  border: 1px dashed rgba(200,170,150,0.55);
  padding: 12px 8px;
  text-align: center;
  cursor: pointer;
  background: rgba(255,248,242,0.6);
  margin-bottom: 10px;
  transition: background 0.2s;
}
.upload-zone:hover { background: rgba(255,235,220,0.8); }
.upload-zone p { font-style: italic; color: #b09880; font-size: 0.78rem; line-height: 1.5; }
#image-file-input { display: none; }

.image-previews { display: flex; flex-wrap: wrap; gap: 5px; margin-bottom: 8px; }
.preview-wrap { position: relative; width: 46px; height: 46px; }
.preview-wrap img {
  width: 46px; height: 46px; object-fit: cover;
  border: 1px solid rgba(200,170,150,0.5);
  display: block;
  filter: sepia(0.1) saturate(0.9);
}
.preview-remove {
  position: absolute; top: -4px; right: -4px;
  background: #c08878; color: white;
  border: none; width: 13px; height: 13px;
  font-size: 0.5rem; cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  border-radius: 50%;
}
.alarm-status { font-style: italic; font-size: 0.72rem; color: #b09880; }
.alarm-status.active { color: #b06848; }

.test-row { margin-top: 10px; padding-top: 8px; border-top: 1px solid rgba(200,170,150,0.25); }

/* ── ALARM OVERLAY ── */
#alarm-overlay {
  display: none; position: fixed; inset: 0;
  z-index: 9999; pointer-events: none; overflow: hidden;
}
#alarm-overlay.active { display: block; pointer-events: all; }

.alarm-popup {
  position: absolute;
  border: 1px solid rgba(200,170,150,0.7);
  box-shadow: 3px 3px 14px rgba(160,110,90,0.28), 0 0 0 1px rgba(255,255,255,0.5);
  overflow: hidden;
  animation: softPop 0.3s cubic-bezier(0.34,1.4,0.64,1) forwards;
  cursor: pointer;
  background: white;
}
.alarm-popup img { display: block; width: 100%; height: calc(100% - 20px); object-fit: cover; filter: sepia(0.1); }
.alarm-popup .popup-label {
  background: linear-gradient(to right, rgba(210,150,130,0.92), rgba(195,135,155,0.92));
  color: white;
  font-family: 'IM Fell English', serif;
  font-style: italic;
  font-size: 0.65rem;
  text-align: center;
  height: 20px;
  display: flex; align-items: center; justify-content: center;
  padding: 0 6px;
}
@keyframes softPop {
  from { transform: scale(0.15) rotate(var(--r,0deg)); opacity: 0; }
  to   { transform: scale(1)    rotate(var(--r,0deg)); opacity: 1; }
}

#dismiss-btn {
  display: none;
  position: fixed; bottom: 24px; left: 50%;
  transform: translateX(-50%);
  z-index: 10000;
  background: linear-gradient(to bottom, #f8e2d4, #e8c8b8);
  color: #7a4838;
  border: 1px solid rgba(200,150,130,0.55);
  padding: 8px 24px;
  font-family: 'IM Fell English', serif;
  font-style: italic;
  font-size: 0.88rem;
  cursor: pointer;
  box-shadow: 2px 2px 12px rgba(180,120,100,0.3), 0 0 0 3px rgba(255,255,255,0.65);
  animation: floatUp 2s ease-in-out infinite;
  white-space: nowrap;
}
@keyframes floatUp {
  0%,100% { transform: translateX(-50%) translateY(0); }
  50%      { transform: translateX(-50%) translateY(-4px); }
}
</style>
</head>
<body>

<div class="widget">

  <!-- TITLE BAR -->
  <div class="title-bar">
    <div class="title-text">
      <span class="title-deco">✦</span>
      my planner
      <span class="title-deco">✦</span>
    </div>
    <button class="settings-btn" onclick="toggleSettings()" title="alarm image settings">⚙</button>
  </div>

  <!-- TABS -->
  <div class="tabs">
    <div class="tab active" onclick="switchTab('notes')">notes</div>
    <div class="tab" onclick="switchTab('tasks')">tasks</div>
  </div>

  <!-- NOTES PANEL -->
  <div class="panel active" id="panel-notes">
    <textarea id="notes-area" placeholder="write anything . . ."></textarea>
    <div class="note-footer">
      <button class="tiny-btn" onclick="saveNotes()">save</button>
      <span class="saved-lbl" id="saved-lbl">✦ saved</span>
    </div>
  </div>

  <!-- TASKS PANEL -->
  <div class="panel" id="panel-tasks">
    <div class="add-row">
      <div class="add-row-top">
        <input type="text" id="task-input" placeholder="add a task . . ." onkeydown="if(event.key==='Enter')addTask()">
        <button class="tiny-btn" onclick="addTask()">+</button>
      </div>
      <div class="due-row">
        <span class="due-label">due date :</span>
        <input type="datetime-local" id="due-input">
      </div>
    </div>
    <ul class="task-list" id="task-list"></ul>
    <div class="empty-msg" id="empty-msg">nothing yet . . . ♪</div>
  </div>

  <!-- SETTINGS OVERLAY -->
  <div class="settings-overlay" id="settings-overlay">
    <div class="settings-header">
      <span class="settings-title">✦ alarm images</span>
      <button class="close-btn" onclick="toggleSettings()">✕</button>
    </div>
    <p class="settings-label">
      these images will multiply across your screen when a deadline is 12 hours away.
    </p>
    <div class="upload-zone" onclick="document.getElementById('image-file-input').click()">
      <p>✿ click to upload<br><span style="font-size:0.7rem;">jpg / png / gif</span></p>
    </div>
    <input type="file" id="image-file-input" accept="image/*" multiple onchange="handleImages(event)">
    <div class="image-previews" id="image-previews"></div>
    <div class="alarm-status" id="alarm-status">no images yet . . .</div>
    <div class="test-row">
      <button class="tiny-btn" onclick="triggerAlarm('test')">test alarm</button>
    </div>
  </div>

</div>

<!-- ALARM -->
<div id="alarm-overlay"></div>
<button id="dismiss-btn" onclick="dismissAlarm()">✦ ok, i'll do it . . . dismiss ✦</button>

<script>
  let tasks = JSON.parse(localStorage.getItem('planner-tasks') || '[]');
  let alarmImages = JSON.parse(localStorage.getItem('planner-images') || '[]');
  let popupInterval = null;
  let firedAlarms = new Set(JSON.parse(localStorage.getItem('fired-alarms') || '[]'));

  // TABS
  function switchTab(name) {
    document.querySelectorAll('.tab').forEach((t,i) => {
      const names = ['notes','tasks'];
      t.classList.toggle('active', names[i] === name);
    });
    document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
    document.getElementById('panel-' + name).classList.add('active');
  }

  // SETTINGS
  function toggleSettings() {
    document.getElementById('settings-overlay').classList.toggle('open');
  }

  // NOTES
  document.getElementById('notes-area').value = localStorage.getItem('planner-notes') || '';
  function saveNotes() {
    localStorage.setItem('planner-notes', document.getElementById('notes-area').value);
    const l = document.getElementById('saved-lbl');
    l.style.display = 'inline'; setTimeout(() => l.style.display = 'none', 1800);
  }
  let nt;
  document.getElementById('notes-area').addEventListener('input', () => { clearTimeout(nt); nt = setTimeout(saveNotes, 1200); });

  // TASKS
  function saveTasks() { localStorage.setItem('planner-tasks', JSON.stringify(tasks)); }
  function addTask() {
    const name = document.getElementById('task-input').value.trim();
    const due = document.getElementById('due-input').value;
    if (!name) return document.getElementById('task-input').focus();
    tasks.push({ id: Date.now(), name, due, done: false });
    saveTasks(); renderTasks();
    document.getElementById('task-input').value = '';
    document.getElementById('due-input').value = '';
  }
  function deleteTask(id) { tasks = tasks.filter(t => t.id !== id); saveTasks(); renderTasks(); }
  function toggleTask(id) { const t = tasks.find(t => t.id === id); if(t) t.done = !t.done; saveTasks(); renderTasks(); }

  function fmtDue(due) {
    if (!due) return '';
    const d = new Date(due);
    return d.toLocaleDateString('en-US',{month:'short',day:'numeric'}) + ' ' +
           d.toLocaleTimeString('en-US',{hour:'numeric',minute:'2-digit'});
  }
  function esc(s) { return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }

  function renderTasks() {
    const list = document.getElementById('task-list');
    const empty = document.getElementById('empty-msg');
    list.innerHTML = '';
    const now = Date.now(), T12 = 12*3600*1000;
    if (!tasks.length) { empty.style.display='block'; return; }
    empty.style.display='none';
    [...tasks].sort((a,b) => {
      if (a.done !== b.done) return a.done ? 1 : -1;
      if (!a.due && !b.due) return 0;
      if (!a.due) return 1; if (!b.due) return -1;
      return new Date(a.due)-new Date(b.due);
    }).forEach(t => {
      const li = document.createElement('li');
      li.className = 'task-item';
      let lbl = '';
      if (t.due && !t.done) {
        const diff = new Date(t.due) - now;
        if (diff < 0) { li.classList.add('overdue'); lbl = 'overdue'; }
        else if (diff < T12) {
          li.classList.add('urgent');
          const h = Math.floor(diff/3600000), m = Math.floor((diff%3600000)/60000);
          lbl = `${h}h ${m}m`;
        } else { lbl = fmtDue(t.due); }
      } else if (t.due) { lbl = fmtDue(t.due); }
      if (t.done) li.classList.add('done');
      li.innerHTML = `
        <input type="checkbox" class="task-check" ${t.done?'checked':''} onchange="toggleTask(${t.id})">
        <span class="task-name">${esc(t.name)}</span>
        ${lbl ? `<span class="task-due">${lbl}</span>` : ''}
        <button class="del-btn" onclick="deleteTask(${t.id})">✕</button>
      `;
      list.appendChild(li);
    });
  }

  // IMAGES
  function handleImages(e) {
    Array.from(e.target.files).forEach(file => {
      const r = new FileReader();
      r.onload = ev => { alarmImages.push(ev.target.result); localStorage.setItem('planner-images', JSON.stringify(alarmImages)); renderPreviews(); };
      r.readAsDataURL(file);
    });
    e.target.value = '';
  }
  function removeImage(i) { alarmImages.splice(i,1); localStorage.setItem('planner-images', JSON.stringify(alarmImages)); renderPreviews(); }
  function renderPreviews() {
    const c = document.getElementById('image-previews');
    const s = document.getElementById('alarm-status');
    c.innerHTML = '';
    alarmImages.forEach((src,i) => {
      const w = document.createElement('div'); w.className = 'preview-wrap';
      w.innerHTML = `<img src="${src}"><button class="preview-remove" onclick="removeImage(${i})">✕</button>`;
      c.appendChild(w);
    });
    s.textContent = alarmImages.length ? `${alarmImages.length} image${alarmImages.length>1?'s':''} ready ✦` : 'no images yet . . .';
    s.className = 'alarm-status' + (alarmImages.length ? ' active' : '');
  }

  // ALARM
  function triggerAlarm(taskName) {
    if (!alarmImages.length) { alert('upload images in settings first . . .'); return; }
    document.getElementById('alarm-overlay').classList.add('active');
    document.getElementById('dismiss-btn').style.display = 'block';
    spawnPopup(taskName);
    popupInterval = setInterval(() => spawnPopup(taskName), 520);
  }
  function spawnPopup(taskName) {
    const overlay = document.getElementById('alarm-overlay');
    const src = alarmImages[Math.floor(Math.random()*alarmImages.length)];
    const size = 120 + Math.random()*180;
    const x = Math.random()*(window.innerWidth - size);
    const y = Math.random()*(window.innerHeight - size - 40);
    const rot = (Math.random()*12 - 6).toFixed(1);
    const div = document.createElement('div');
    div.className = 'alarm-popup';
    div.style.cssText = `left:${x}px;top:${y}px;width:${size}px;height:${size+20}px;--r:${rot}deg;transform:rotate(${rot}deg);`;
    div.innerHTML = `<img src="${src}" alt=""><div class="popup-label">✦ ${taskName} is due soon ✦</div>`;
    div.onclick = () => div.remove();
    overlay.appendChild(div);
    const all = overlay.querySelectorAll('.alarm-popup');
    if (all.length > 45) all[0].remove();
  }
  function dismissAlarm() {
    clearInterval(popupInterval);
    document.getElementById('alarm-overlay').innerHTML = '';
    document.getElementById('alarm-overlay').classList.remove('active');
    document.getElementById('dismiss-btn').style.display = 'none';
  }

  // DEADLINE CHECK
  function checkDeadlines() {
    const now = Date.now(), T12 = 12*3600*1000;
    tasks.forEach(t => {
      if (t.done || !t.due) return;
      const diff = new Date(t.due) - now;
      if (diff > 0 && diff <= T12 && !firedAlarms.has(t.id)) {
        firedAlarms.add(t.id);
        localStorage.setItem('fired-alarms', JSON.stringify([...firedAlarms]));
        setTimeout(() => triggerAlarm(t.name), 400);
      }
    });
    renderTasks();
  }

  renderTasks(); renderPreviews(); checkDeadlines();
  setInterval(checkDeadlines, 60000);
</script>
</body>
</html>
